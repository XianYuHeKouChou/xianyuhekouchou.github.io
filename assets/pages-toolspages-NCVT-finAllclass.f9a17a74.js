import{g as e,s as t,o as s,c as i,w as o,a as l,p as a,F as r,q as n,n as u,d as c,C as h,i as d,f as p,e as m,D as f,I as x,A as y,B as g,E as v,h as S,z as b,t as _,u as w,j as I}from"./index-518cc2ab.js";import{_ as z}from"./uni-notice-bar.4f0c4c37.js";import{r as C}from"./uni-app.es.439b5666.js";import{_ as V}from"./uni-fab.447ea7cf.js";import{_ as k}from"./uni-card.a44f7720.js";import{_ as $,a as N}from"./uni-popup.baefeb70.js";import{_ as j}from"./uni-icons.182aacaf.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";const M=B({name:"UniRate",props:{isFill:{type:[Boolean,String],default:!0},color:{type:String,default:"#ececec"},activeColor:{type:String,default:"#ffca3e"},disabledColor:{type:String,default:"#c0c0c0"},size:{type:[Number,String],default:24},value:{type:[Number,String],default:0},modelValue:{type:[Number,String],default:0},max:{type:[Number,String],default:5},margin:{type:[Number,String],default:0},disabled:{type:[Boolean,String],default:!1},readonly:{type:[Boolean,String],default:!1},allowHalf:{type:[Boolean,String],default:!1},touchable:{type:[Boolean,String],default:!0}},data:()=>({valueSync:"",userMouseFristMove:!0,userRated:!1,userLastRate:1}),watch:{value(e){this.valueSync=Number(e)},modelValue(e){this.valueSync=Number(e)}},computed:{stars(){const e=this.valueSync?this.valueSync:0,t=[],s=Math.floor(e),i=Math.ceil(e);for(let o=0;o<this.max;o++)s>o?t.push({activeWitch:"100%"}):i-1===o?t.push({activeWitch:100*(e-s)+"%"}):t.push({activeWitch:"0"});return t},marginNumber(){return Number(this.margin)}},created(){this.valueSync=Number(this.value||this.modelValue),this._rateBoxLeft=0,this._oldValue=null},mounted(){setTimeout((()=>{this._getSize()}),100),this.PC=this.IsPC()},methods:{touchstart(e){if(this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t,screenX:s}=e.changedTouches[0];this._getRateCount(t||s)},touchmove(e){if(this.IsPC())return;if(this.readonly||this.disabled||!this.touchable)return;const{clientX:t,screenX:s}=e.changedTouches[0];this._getRateCount(t||s)},mousedown(e){if(!this.IsPC())return;if(this.readonly||this.disabled)return;const{clientX:t}=e;this.userLastRate=this.valueSync,this._getRateCount(t),this.userRated=!0},mousemove(e){if(!this.IsPC())return;if(this.userRated)return;if(this.userMouseFristMove&&(console.log("---mousemove----",this.valueSync),this.userLastRate=this.valueSync,this.userMouseFristMove=!1),this.readonly||this.disabled||!this.touchable)return;const{clientX:t}=e;this._getRateCount(t)},mouseleave(e){this.IsPC()&&(this.readonly||this.disabled||!this.touchable||(this.userRated?this.userRated=!1:this.valueSync=this.userLastRate))},IsPC(){var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0;for(let i=0;i<t.length-1;i++)if(e.indexOf(t[i])>0){s=!1;break}return s},_getRateCount(e){const t=this;this._getSize((function(){const s=Number(t.size);if(isNaN(s))return new Error("size 属性只能设置为数字");const i=e-t._rateBoxLeft;let o=parseInt(i/(s+t.marginNumber));o=o<0?0:o,o=o>t.max?t.max:o;const l=parseInt(i-(s+t.marginNumber)*o);let a=0;(t._oldValue!==o||t.PC)&&(t._oldValue=o,a=t.allowHalf?l>s/2?o+1:o+.5:o+1,a=Math.max(.5,Math.min(a,t.max)),t.valueSync=a,t._onChange())}))},_onChange(){this.$emit("input",this.valueSync),this.$emit("update:modelValue",this.valueSync),this.$emit("change",{value:this.valueSync})},_getSize(t){e().in(this).select(".uni-rate").boundingClientRect().exec((e=>{e&&(this._rateBoxLeft=e[0].left,t&&t())}))}}},[["render",function(e,p,m,f,x,y){const g=C(t("uni-icons"),j),v=d;return s(),i(v,null,{default:o((()=>[l(v,{ref:"uni-rate",class:"uni-rate"},{default:o((()=>[(s(!0),a(r,null,n(y.stars,((e,t)=>(s(),i(v,{class:u(["uni-rate__icon",{"uni-cursor-not-allowed":m.disabled}]),style:c({"margin-right":y.marginNumber+"px"}),key:t,onTouchstart:h(y.touchstart,["stop"]),onTouchmove:h(y.touchmove,["stop"]),onMousedown:h(y.mousedown,["stop"]),onMousemove:h(y.mousemove,["stop"]),onMouseleave:y.mouseleave},{default:o((()=>[l(g,{color:m.color,size:m.size,type:m.isFill?"star-filled":"star"},null,8,["color","size","type"]),l(v,{style:c({width:e.activeWitch}),class:"uni-rate__icon-on"},{default:o((()=>[l(g,{color:m.disabled?m.disabledColor:m.activeColor,size:m.size,type:"star-filled"},null,8,["color","size"])])),_:2},1032,["style"])])),_:2},1032,["class","style","onTouchstart","onTouchmove","onMousedown","onMousemove","onMouseleave"])))),128))])),_:1},512)])),_:1})}],["__scopeId","data-v-1622af8e"]]);function D(e){let t="";for(let s in e){t+=`${s}:${e[s]};`}return t}const T=B({name:"uni-easyinput",emits:["click","iconClick","update:modelValue","input","focus","blur","confirm","clear","eyes","change","keyboardheightchange"],model:{prop:"modelValue",event:"update:modelValue"},options:{virtualHost:!0},inject:{form:{from:"uniForm",default:null},formItem:{from:"uniFormItem",default:null}},props:{name:String,value:[Number,String],modelValue:[Number,String],type:{type:String,default:"text"},clearable:{type:Boolean,default:!0},autoHeight:{type:Boolean,default:!1},placeholder:{type:String,default:" "},placeholderStyle:String,focus:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},maxlength:{type:[Number,String],default:140},confirmType:{type:String,default:"done"},clearSize:{type:[Number,String],default:24},inputBorder:{type:Boolean,default:!0},prefixIcon:{type:String,default:""},suffixIcon:{type:String,default:""},trim:{type:[Boolean,String],default:!1},cursorSpacing:{type:Number,default:0},passwordIcon:{type:Boolean,default:!0},primaryColor:{type:String,default:"#2979ff"},styles:{type:Object,default:()=>({color:"#333",backgroundColor:"#fff",disableColor:"#F7F6F6",borderColor:"#e5e5e5"})},errorMessage:{type:[String,Boolean],default:""}},data:()=>({focused:!1,val:"",showMsg:"",border:!1,isFirstBorder:!1,showClearIcon:!1,showPassword:!1,focusShow:!1,localMsg:"",isEnter:!1}),computed:{isVal(){const e=this.val;return!(!e&&0!==e)},msg(){return this.localMsg||this.errorMessage},inputMaxlength(){return Number(this.maxlength)},boxStyle(){return`color:${this.inputBorder&&this.msg?"#e43d33":this.styles.color};`},inputContentClass(){return function(e){let t="";for(let s in e)e[s]&&(t+=`${s} `);return t}({"is-input-border":this.inputBorder,"is-input-error-border":this.inputBorder&&this.msg,"is-textarea":"textarea"===this.type,"is-disabled":this.disabled,"is-focused":this.focusShow})},inputContentStyle(){const e=this.focusShow?this.primaryColor:this.styles.borderColor;return D({"border-color":(this.inputBorder&&this.msg?"#dd524d":e)||"#e5e5e5","background-color":this.disabled?this.styles.disableColor:this.styles.backgroundColor})},inputStyle(){return D({"padding-right":"password"===this.type||this.clearable||this.prefixIcon?"":"10px","padding-left":this.prefixIcon?"":"10px"})}},watch:{value(e){this.val=e},modelValue(e){this.val=e},focus(e){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))}},created(){this.init(),this.form&&this.formItem&&this.$watch("formItem.errMsg",(e=>{this.localMsg=e}))},mounted(){this.$nextTick((()=>{this.focused=this.focus,this.focusShow=this.focus}))},methods:{init(){this.value||0===this.value?this.val=this.value:this.modelValue||0===this.modelValue||""===this.modelValue?this.val=this.modelValue:this.val=null},onClickIcon(e){this.$emit("iconClick",e)},onEyes(){this.showPassword=!this.showPassword,this.$emit("eyes",this.showPassword)},onInput(e){let t=e.detail.value;this.trim&&("boolean"==typeof this.trim&&this.trim&&(t=this.trimStr(t)),"string"==typeof this.trim&&(t=this.trimStr(t,this.trim))),this.errMsg&&(this.errMsg=""),this.val=t,this.$emit("input",t),this.$emit("update:modelValue",t)},onFocus(){this.$nextTick((()=>{this.focused=!0})),this.$emit("focus",null)},_Focus(e){this.focusShow=!0,this.$emit("focus",e)},onBlur(){this.focused=!1,this.$emit("focus",null)},_Blur(e){if(e.detail.value,this.focusShow=!1,this.$emit("blur",e),!1===this.isEnter&&this.$emit("change",this.val),this.form&&this.formItem){const{validateTrigger:e}=this.form;"blur"===e&&this.formItem.onFieldChange()}},onConfirm(e){this.$emit("confirm",this.val),this.isEnter=!0,this.$emit("change",this.val),this.$nextTick((()=>{this.isEnter=!1}))},onClear(e){this.val="",this.$emit("input",""),this.$emit("update:modelValue",""),this.$emit("clear")},onkeyboardheightchange(e){this.$emit("keyboardheightchange",e)},trimStr:(e,t="both")=>"both"===t?e.trim():"left"===t?e.trimLeft():"right"===t?e.trimRight():"start"===t?e.trimStart():"end"===t?e.trimEnd():"all"===t?e.replace(/\s+/g,""):e}},[["render",function(e,n,h,y,g,v){const S=C(t("uni-icons"),j),b=f,_=x,w=d;return s(),i(w,{class:u(["uni-easyinput",{"uni-easyinput-error":v.msg}]),style:c(v.boxStyle)},{default:o((()=>[l(w,{class:u(["uni-easyinput__content",v.inputContentClass]),style:c(v.inputContentStyle)},{default:o((()=>[h.prefixIcon?(s(),i(S,{key:0,class:"content-clear-icon",type:h.prefixIcon,color:"#c0c4cc",onClick:n[0]||(n[0]=e=>v.onClickIcon("prefix")),size:"22"},null,8,["type"])):p("",!0),"textarea"===h.type?(s(),i(b,{key:1,class:u(["uni-easyinput__content-textarea",{"input-padding":h.inputBorder}]),name:h.name,value:g.val,placeholder:h.placeholder,placeholderStyle:h.placeholderStyle,disabled:h.disabled,"placeholder-class":"uni-easyinput__placeholder-class",maxlength:v.inputMaxlength,focus:g.focused,autoHeight:h.autoHeight,"cursor-spacing":h.cursorSpacing,onInput:v.onInput,onBlur:v._Blur,onFocus:v._Focus,onConfirm:v.onConfirm,onKeyboardheightchange:v.onkeyboardheightchange},null,8,["class","name","value","placeholder","placeholderStyle","disabled","maxlength","focus","autoHeight","cursor-spacing","onInput","onBlur","onFocus","onConfirm","onKeyboardheightchange"])):(s(),i(_,{key:2,type:"password"===h.type?"text":h.type,class:"uni-easyinput__content-input",style:c(v.inputStyle),name:h.name,value:g.val,password:!g.showPassword&&"password"===h.type,placeholder:h.placeholder,placeholderStyle:h.placeholderStyle,"placeholder-class":"uni-easyinput__placeholder-class",disabled:h.disabled,maxlength:v.inputMaxlength,focus:g.focused,confirmType:h.confirmType,"cursor-spacing":h.cursorSpacing,onFocus:v._Focus,onBlur:v._Blur,onInput:v.onInput,onConfirm:v.onConfirm,onKeyboardheightchange:v.onkeyboardheightchange},null,8,["type","style","name","value","password","placeholder","placeholderStyle","disabled","maxlength","focus","confirmType","cursor-spacing","onFocus","onBlur","onInput","onConfirm","onKeyboardheightchange"])),"password"===h.type&&h.passwordIcon?(s(),a(r,{key:3},[v.isVal?(s(),i(S,{key:0,class:u(["content-clear-icon",{"is-textarea-icon":"textarea"===h.type}]),type:g.showPassword?"eye-slash-filled":"eye-filled",size:22,color:g.focusShow?h.primaryColor:"#c0c4cc",onClick:v.onEyes},null,8,["class","type","color","onClick"])):p("",!0)],64)):h.suffixIcon?(s(),a(r,{key:4},[h.suffixIcon?(s(),i(S,{key:0,class:"content-clear-icon",type:h.suffixIcon,color:"#c0c4cc",onClick:n[1]||(n[1]=e=>v.onClickIcon("suffix")),size:"22"},null,8,["type"])):p("",!0)],64)):(s(),a(r,{key:5},[h.clearable&&v.isVal&&!h.disabled&&"textarea"!==h.type?(s(),i(S,{key:0,class:u(["content-clear-icon",{"is-textarea-icon":"textarea"===h.type}]),type:"clear",size:h.clearSize,color:v.msg?"#dd524d":g.focusShow?h.primaryColor:"#c0c4cc",onClick:v.onClear},null,8,["class","size","color","onClick"])):p("",!0)],64)),m(e.$slots,"right",{},void 0,!0)])),_:3},8,["class","style"])])),_:3},8,["class","style"])}],["__scopeId","data-v-a08716d2"]]);const P=B({data:()=>({allwpjVideos:[],allxxzVideos:[],SettimeallxxzVideos:[],showallxxzVideos:[],wpj_p:1,wpj_maxID:null,xxz_p:1,xxz_maxID:null,settime:null,No_Offpower:0,stars:1,commentStr:""}),onBackPress(){clearInterval(this.settime)},methods:{getMeunindex(e){if(0===e.index)return 1===this.No_Offpower?void plus.nativeUI.toast("请先暂停学习"):(this.allxxzVideos=[],this.allwpjVideos=[],this.SettimeallxxzVideos=[],this.showallxxzVideos=[],this.wpj_p=1,this.wpj_maxID=null,this.xxz_p=1,this.xxz_maxID=null,void y({title:"获取中",success:()=>{this.getAllwpjvideos()}}));if(1===e.index){if(0===this.allxxzVideos.length)return void plus.nativeUI.toast("请先获取课程");if(1===this.No_Offpower)return void plus.nativeUI.toast("请先暂停学习");this.startAllxxzvideos()}else if(2===e.index){if(0===this.No_Offpower)return void plus.nativeUI.toast("请先开始学习");this.stopAllxxzvideos()}else if(3===e.index){if(0===this.allwpjVideos.length)return void plus.nativeUI.toast("您没有要评价的课程");if(""==this.commentStr)return plus.nativeUI.toast("请先设置评价信息");this.finishvideos()}else 4===e.index&&this.$refs.popup.open()},getAllwpjvideos(){this.$req.post("Student/My/myCourse_wpj.html",{p:this.wpj_p,maxID:this.wpj_maxID},(e=>{let t=JSON.parse(e.data);0!=t[1].length?(this.wpj_maxID=t[0],this.wpj_p=this.wpj_p+1,t[1].map(((e,t)=>{e.css="c-br",e.finish="未评价",this.allwpjVideos.push(e)})),this.getAllwpjvideos()):this.getAllxxzvideos()}))},getAllxxzvideos(){this.$req.post("Student/My/myCourse_xxz.html",{p:this.xxz_p,maxID:this.xxz_maxID},(e=>{let t=JSON.parse(e.data);return 1==this.xxz_p&&0==t[1].length?(g(),void plus.nativeUI.toast("您没有学习中的课程了")):0==t[1].length?(this.showallxxzVideos=this.allxxzVideos,void g()):(this.xxz_maxID=t[0],this.xxz_p=this.xxz_p+1,t[1].map(((e,t)=>{this.allxxzVideos.push(e)})),void this.getAllxxzvideos())}))},startAllxxzvideos(){let e=0;this.allxxzVideos.map(((t,s)=>{this.$req.post("Student/Course/getSecondsAndRemmberStartTime.html",{courseID:t.courseID},(s=>{let i=s.data;t.remainder=i,e++,e==this.allxxzVideos.length&&(this.allxxzVideos.sort(((e,t)=>e.remainder-t.remainder)),this.SettimeallxxzVideos=JSON.parse(JSON.stringify(this.allxxzVideos)),this.showallxxzVideos=this.SettimeallxxzVideos,this.DomsetTime(),this.No_Offpower=1)}))}))},DomsetTime(){this.settime=setInterval((()=>{this.SettimeallxxzVideos.map(((e,t)=>{0!=e.remainder?(e.remainder=e.remainder-1,v({title:"请输入要修改的分数",editable:!0,placeholderText:"输入大于0且小于100的整数",success:function(e){e.confirm?(console.log("用户点击确定"),console.log(e.content)):e.cancel&&console.log("用户点击取消")}})):this.stopAllxxzvideo(e)}))}),1e3)},stopAllxxzvideo(e){let t=[];t=this.allxxzVideos.filter((function(t){return t.css="c-br",t.finish="未评价",t.courseID===e.courseID})),console.log(t),this.$req.post("Student/Course/remmberStudyTime.html",{courseID:t[0].courseID,restTime:t[0].remainder},(s=>{this.allwpjVideos.push(t[0]);let i=[];i=this.allxxzVideos.filter((function(t){return t.courseID!==e.courseID})),this.allxxzVideos=JSON.parse(JSON.stringify(i));let o=[];o=this.SettimeallxxzVideos.filter((function(t){return t.courseID!==e.courseID})),this.SettimeallxxzVideos=JSON.parse(JSON.stringify(o)),this.showallxxzVideos=this.SettimeallxxzVideos}))},stopAllxxzvideos(){let e=0;this.allxxzVideos.map(((t,s)=>{this.$req.post("Student/Course/remmberStudyTime.html",{courseID:t.courseID,restTime:t.remainder},(s=>{let i=s.data;t.remainder=i,e++,e==this.allxxzVideos.length&&(this.SettimeallxxzVideos=JSON.parse(JSON.stringify(this.allxxzVideos)),this.showallxxzVideos=this.SettimeallxxzVideos,clearInterval(this.settime),plus.nativeUI.toast("暂停完成"),this.No_Offpower=0)}))}))},finishvideos(){let e=0;this.allwpjVideos.map(((t,s)=>{this.$req.post("/Student/Course/comment.html",{courseID:t.courseID,stars:this.stars,commentStr:this.commentStr},(s=>{t.css="c-gree",t.finish="已评价",e++,e==this.allwpjVideos.length&&plus.nativeUI.toast("评价完成")}))}))},close(e){if(0===e)this.$refs.popup.close();else if(1===e){if(""==this.commentStr)return plus.nativeUI.toast("请输入内容");this.$refs.popup.close()}}}},[["render",function(e,c,h,p,m,f){const x=C(t("uni-notice-bar"),z),y=C(t("uni-fab"),V),g=I,v=C(t("uni-card"),k),j=C(t("uni-title"),$),B=C(t("uni-rate"),M),D=C(t("uni-easyinput"),T),P=d,F=b,O=C(t("uni-popup"),N);return s(),i(P,null,{default:o((()=>[l(x,{class:"postop",scrollable:"","show-icon":"",text:"为减轻服务器和手机的负载,课程剩余时间需要开始学习后才能查看.本页面的学习剩余倒计时消耗手机性能极大,如在运行时出现问题请手动停止学习"}),l(y,{content:this.$req.Meunarr,onTrigger:f.getMeunindex},null,8,["content","onTrigger"]),(s(!0),a(r,null,n(m.allwpjVideos,((t,a)=>(s(),i(v,{key:a,"is-shadow":!0,cover:e.$req.getIP()+`/upload/courseImgs/${t.courseImg}`},{default:o((()=>[l(g,{class:"uni-body"},{default:o((()=>[S(_(t.courseName),1)])),_:2},1024),w("p",{class:u(t.css)},_(t.finish),3)])),_:2},1032,["cover"])))),128)),(s(!0),a(r,null,n(m.showallxxzVideos,((t,a)=>(s(),i(v,{key:a,"is-shadow":!0,cover:e.$req.getIP()+`/upload/courseImgs/${t.courseImg}`},{default:o((()=>[l(g,{class:"uni-body"},{default:o((()=>[S(_(t.courseName),1)])),_:2},1024),w("p",{class:"uni-body c-br"},"学习中"),w("p",{class:"uni-body c-br"},"剩余: "+_(t.remainder)+" 秒",1)])),_:2},1032,["cover"])))),128)),l(O,{ref:"popup","mask-click":!1},{default:o((()=>[l(P,{class:"bc-w user flex fd-y pl3 pr3 pt1 pb1 ai-c",style:{"border-radius":"20px"}},{default:o((()=>[l(j,{title:"请对课程进行评价",type:"h3"}),l(B,{modelValue:m.stars,"onUpdate:modelValue":c[0]||(c[0]=e=>m.stars=e),"is-fill":!1},null,8,["modelValue"]),l(P,{class:"mt2 w-100"},{default:o((()=>[l(D,{type:"textarea",maxlength:"200",autoHeight:"",modelValue:m.commentStr,"onUpdate:modelValue":c[1]||(c[1]=e=>m.commentStr=e),placeholder:"请对课程进行评价 (200字以内）"},null,8,["modelValue"])])),_:1}),l(P,{class:"mt3 flex w-100"},{default:o((()=>[l(F,{type:"primary",plain:"true",class:"mr1",style:{flex:"1"},onClick:c[2]||(c[2]=e=>f.close(0))},{default:o((()=>[S("取消")])),_:1}),l(F,{type:"primary",plain:"true",class:"mr1",style:{flex:"1"},onClick:c[3]||(c[3]=e=>f.close(1))},{default:o((()=>[S("确认")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-720421ed"]]);export{P as default};
